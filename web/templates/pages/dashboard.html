<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SiteWatch</title>
    
    <!-- Essential Scripts -->
    <script src="/static/js/htmx.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Base Styles -->
    <style>
        /* HTMX Indicators */
        .htmx-indicator {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .htmx-request .htmx-indicator {
            opacity: 1;
        }
        
        /* Loading States */
        .loading-skeleton {
            background: linear-gradient(-90deg, #f0f0f0 0%, #e0e0e0 50%, #f0f0f0 100%);
            background-size: 400% 400%;
            animation: pulse-skeleton 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse-skeleton {
            0% { background-position: 0% 0%; }
            100% { background-position: -135% 0%; }
        }
        
        /* Touch Utilities */
        .touch-active {
            transform: scale(0.95);
            background-color: #f9fafb;
            transition: all 0.15s;
        }
        
        .touch-target {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Mobile Utilities */
        @media (max-width: 640px) {
            .mobile-hidden { display: none; }
            .mobile-scroll { overflow-x: auto; }
        }
    </style>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="h-full">
    <div class="min-h-full flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="mx-auto max-w-7xl px-4 py-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between">
                    <!-- Logo/Title -->
                    <h1 class="text-2xl sm:text-3xl font-bold tracking-tight text-gray-900 flex items-center">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 mr-2 sm:mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.348 14.651a3.75 3.75 0 010-5.303m5.304 0a3.75 3.75 0 010 5.303m-7.425 2.122a6.75 6.75 0 010-9.546m9.546 0a6.75 6.75 0 010 9.546M5.106 18.894c3.808-3.808 9.98-3.808 13.788 0"/>
                        </svg>
                        <span class="hidden sm:inline">SiteWatch Dashboard</span>
                        <span class="sm:hidden">SiteWatch</span>
                    </h1>
                    
                    <!-- Header Actions -->
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        <div class="flex items-center text-xs sm:text-sm text-gray-600">
                            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse-slow mr-2" aria-hidden="true"></div>
                            <span class="mobile-hidden">Auto-refresh: 5s</span>
                            <span class="sm:hidden">5s</span>
                        </div>
                        <button 
                            hx-get="/ui/sites" 
                            hx-target="#sites-container"
                            class="inline-flex items-center px-2 sm:px-3 py-2 border border-transparent text-xs sm:text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 touch-target"
                            aria-label="Refresh dashboard data">
                            <svg class="w-4 h-4 sm:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            <span class="mobile-hidden">Refresh Now</span>
                        </button>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="mt-4 border-b border-gray-200">
                    <nav class="-mb-px flex space-x-4 sm:space-x-8 mobile-scroll" role="tablist" aria-label="Dashboard navigation">
                        <button 
                            id="dashboard-tab"
                            onclick="showTab('dashboard')"
                            class="tab-button active border-blue-500 text-blue-600 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm touch-target"
                            role="tab"
                            aria-selected="true"
                            aria-controls="dashboard-content"
                            tabindex="0">
                            <svg class="w-4 h-4 mr-1 sm:mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                            Dashboard
                        </button>
                        <button 
                            id="logs-tab"
                            onclick="showTab('logs')"
                            class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm touch-target"
                            role="tab"
                            aria-selected="false"
                            aria-controls="logs-content"
                            tabindex="-1">
                            <svg class="w-4 h-4 mr-1 sm:mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Logs
                        </button>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main role="main" class="flex-1">
            <div class="mx-auto max-w-7xl py-4 sm:py-6 px-4 sm:px-6 lg:px-8">
                <!-- Dashboard Tab Content -->
                <div id="dashboard-content" class="tab-content" role="tabpanel" aria-labelledby="dashboard-tab" aria-hidden="false">
                    <!-- Status Overview -->
                    <div class="mb-6">
                        <div 
                            id="overview-container"
                            hx-get="/ui/overview" 
                            hx-trigger="load, every 5s"
                            hx-swap="innerHTML"
                            role="region"
                            aria-label="System overview"
                            aria-live="polite">
                            <!-- Loading skeleton -->
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-5 sm:p-6">
                                    <div class="loading-skeleton h-6 w-32 mb-4"></div>
                                    <div class="grid grid-cols-2 gap-4 sm:grid-cols-4">
                                        <div class="loading-skeleton h-16 rounded"></div>
                                        <div class="loading-skeleton h-16 rounded"></div>
                                        <div class="loading-skeleton h-16 rounded"></div>
                                        <div class="loading-skeleton h-16 rounded"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sites Grid -->
                    <div 
                        id="sites-container"
                        hx-get="/ui/sites" 
                        hx-trigger="load, every 5s"
                        hx-swap="innerHTML"
                        role="region"
                        aria-label="Site status cards"
                        aria-live="polite">
                        <!-- Loading skeleton for sites -->
                        <div class="grid grid-cols-1 gap-4 sm:gap-6 sm:grid-cols-2 lg:grid-cols-3">
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-5 sm:p-6">
                                    <div class="loading-skeleton h-6 w-24 mb-2"></div>
                                    <div class="loading-skeleton h-4 w-16 mb-4"></div>
                                    <div class="loading-skeleton h-8 rounded"></div>
                                </div>
                            </div>
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-5 sm:p-6">
                                    <div class="loading-skeleton h-6 w-24 mb-2"></div>
                                    <div class="loading-skeleton h-4 w-16 mb-4"></div>
                                    <div class="loading-skeleton h-8 rounded"></div>
                                </div>
                            </div>
                            <div class="bg-white overflow-hidden shadow rounded-lg">
                                <div class="px-4 py-5 sm:p-6">
                                    <div class="loading-skeleton h-6 w-24 mb-2"></div>
                                    <div class="loading-skeleton h-4 w-16 mb-4"></div>
                                    <div class="loading-skeleton h-8 rounded"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="mt-8">
                        <div class="bg-white overflow-hidden shadow rounded-lg">
                            <div class="px-4 py-5 sm:p-6">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                    </svg>
                                    Quick Actions
                                </h3>
                                <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
                                    <a 
                                        href="/metrics" 
                                        target="_blank"
                                        class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 touch-target"
                                        rel="noopener noreferrer">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                        </svg>
                                        Metrics
                                    </a>
                                    <a 
                                        href="/api/sites" 
                                        target="_blank"
                                        class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 touch-target"
                                        rel="noopener noreferrer">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                        API
                                    </a>
                                    <a 
                                        href="/health" 
                                        target="_blank"
                                        class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 touch-target"
                                        rel="noopener noreferrer">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                        </svg>
                                        Health
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logs Tab Content -->
                <div id="logs-content" class="tab-content hidden" role="tabpanel" aria-labelledby="logs-tab">
                    <div 
                        id="logs-container"
                        hx-get="/ui/logs" 
                        hx-trigger="load"
                        hx-swap="innerHTML">
                        <!-- Loading skeleton table -->
                        <div class="bg-white shadow overflow-hidden sm:rounded-md">
                            <div class="px-4 py-5 sm:px-6">
                                <div class="loading-skeleton h-6 w-32 mb-2"></div>
                                <div class="loading-skeleton h-4 w-48"></div>
                            </div>
                            <div class="border-t border-gray-200">
                                <div class="loading-skeleton h-12 mb-1"></div>
                                <div class="loading-skeleton h-12 mb-1"></div>
                                <div class="loading-skeleton h-12 mb-1"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Tab Content -->
                <div id="enhanced-content" class="tab-content hidden" role="tabpanel" aria-labelledby="enhanced-tab">
                    <div id="enhanced-fragment-container">
                        <!-- Enhanced content will be loaded here -->
                        <div class="flex items-center justify-center py-12">
                            <div class="text-center">
                                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                </svg>
                                <h3 class="mt-2 text-sm font-medium text-gray-900">Select a site</h3>
                                <p class="mt-1 text-sm text-gray-500">Choose a site from the dashboard to view detailed analytics.</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 mt-8">
            <div class="mx-auto max-w-7xl px-4 py-4 sm:px-6 lg:px-8">
                <div class="text-center text-sm text-gray-500">
                    <p>SiteWatch - Network Monitoring Dashboard</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Modal Container for Details -->
    <div id="modal-container"></div>
    
    <!-- Core JavaScript -->
    <script src="/static/js/sitewatch-core.js"></script>
    
    <!-- Dashboard JavaScript -->
    <script>
        // Tab management
        function showTab(tabName) {
            // Update URL based on tab selection
            updateURL(tabName);
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
                content.setAttribute('aria-hidden', 'true');
            });
            
            // Show selected tab
            const targetContent = document.getElementById(tabName + '-content');
            if (targetContent) {
                targetContent.classList.remove('hidden');
                targetContent.setAttribute('aria-hidden', 'false');
            }
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                const isActive = button.id === tabName + '-tab';
                button.classList.toggle('active', isActive);
                button.classList.toggle('border-blue-500', isActive);
                button.classList.toggle('text-blue-600', isActive);
                button.classList.toggle('border-transparent', !isActive);
                button.classList.toggle('text-gray-500', !isActive);
                button.setAttribute('aria-selected', isActive.toString());
                button.setAttribute('tabindex', isActive ? '0' : '-1');
            });
            
            // Load specific tab content
            if (tabName === 'logs') {
                const logsContainer = document.getElementById('logs-container');
                if (logsContainer && typeof htmx !== 'undefined') {
                    htmx.trigger(logsContainer, 'load');
                }
            } else if (tabName === 'enhanced') {
                const urlParams = new URLSearchParams(window.location.search);
                const siteId = urlParams.get('site');
                if (siteId) {
                    loadEnhancedView(siteId);
                }
            }
        }
        
        // URL management
        function updateURL(tabName) {
            const url = new URL(window.location);
            
            if (tabName === 'dashboard') {
                // Dashboard tab: clear all parameters
                url.search = '';
            } else if (tabName === 'logs') {
                // Logs tab: keep only logs-related parameters
                const newParams = new URLSearchParams();
                const currentParams = new URLSearchParams(url.search);
                
                // Keep relevant parameters for logs
                ['site', 'success', 'limit'].forEach(param => {
                    if (currentParams.has(param)) {
                        newParams.set(param, currentParams.get(param));
                    }
                });
                
                newParams.set('tab', 'logs');
                url.search = newParams.toString();
            } else if (tabName === 'enhanced') {
                // Enhanced tab: keep site parameter if present
                const currentParams = new URLSearchParams(url.search);
                const newParams = new URLSearchParams();
                
                if (currentParams.has('site')) {
                    newParams.set('site', currentParams.get('site'));
                }
                newParams.set('tab', 'enhanced');
                url.search = newParams.toString();
            }
            
            // Update the URL without triggering a page reload
            window.history.pushState(null, '', url.toString());
        }
        
        // Load enhanced view for specific site
        function loadEnhancedView(siteId) {
            const container = document.getElementById('enhanced-fragment-container');
            if (container) {
                container.innerHTML = '<div class="flex items-center justify-center py-12"><div class="animate-spin h-8 w-8 border-4 border-blue-600 border-t-transparent rounded-full"></div></div>';
                
                console.log('🚀 Loading enhanced view for site:', siteId);
                
                fetch(`/ui/enhanced-fragment/${siteId}`)
                    .then(response => {
                        console.log('📡 Enhanced fragment response:', response.status);
                        return response.text();
                    })
                    .then(html => {
                        console.log('📄 Enhanced fragment HTML loaded, length:', html.length);
                        container.innerHTML = html;
                        
                        // Execute any scripts in the loaded HTML
                        const scripts = container.querySelectorAll('script');
                        scripts.forEach(script => {
                            console.log('🔧 Executing script from fragment...');
                            const newScript = document.createElement('script');
                            if (script.src) {
                                newScript.src = script.src;
                            } else {
                                newScript.textContent = script.textContent;
                            }
                            document.head.appendChild(newScript);
                            document.head.removeChild(newScript);
                        });
                        
                        // Give the DOM and scripts time to render/execute, then try to initialize charts
                        setTimeout(() => {
                            console.log('🔧 Checking for chart initialization function...');
                            if (typeof window.initializeEnhancedCharts === 'function') {
                                console.log('✅ Found window.initializeEnhancedCharts, calling it...');
                                window.initializeEnhancedCharts();
                            } else {
                                console.warn('❌ window.initializeEnhancedCharts function not found');
                                console.log('Available functions:', Object.keys(window).filter(k => k.includes('Chart') || k.includes('chart')));
                            }
                        }, 200);
                    })
                    .catch(error => {
                        console.error('❌ Error loading enhanced fragment:', error);
                        container.innerHTML = `
                            <div class="text-center py-12">
                                <svg class="mx-auto h-12 w-12 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-2.694-.833-3.464 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                </svg>
                                <h3 class="mt-2 text-sm font-medium text-gray-900">Error loading enhanced view</h3>
                                <p class="mt-1 text-sm text-gray-500">Could not load detailed analytics for site ${siteId}. Error: ${error.message}</p>
                            </div>`;
                    });
            } else {
                console.error('❌ Enhanced fragment container not found');
            }
        }
        
        // Modal management for site details
        function showModal(html) {
            const modalContainer = document.getElementById('modal-container');
            if (modalContainer) {
                modalContainer.innerHTML = `
                    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50">
                        <div class="bg-white rounded-lg max-w-lg w-full max-h-screen overflow-y-auto">
                            <div class="flex items-center justify-between p-4 border-b">
                                <h2 class="text-lg font-medium text-gray-900">Site Details</h2>
                                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="p-4">
                                ${html}
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        function closeModal() {
            const modalContainer = document.getElementById('modal-container');
            if (modalContainer) {
                modalContainer.innerHTML = '';
            }
        }
        
        // Handle URL parameters on page load
        function handleUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            
            if (tab === 'enhanced') {
                // Don't call updateURL here to avoid infinite loop
                showTabWithoutURL('enhanced');
            } else if (tab === 'logs') {
                showTabWithoutURL('logs');
            } else {
                // Default to dashboard tab
                showTabWithoutURL('dashboard');
            }
        }
        
        // Show tab without updating URL (used for URL handling)
        function showTabWithoutURL(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
                content.setAttribute('aria-hidden', 'true');
            });
            
            // Show selected tab
            const targetContent = document.getElementById(tabName + '-content');
            if (targetContent) {
                targetContent.classList.remove('hidden');
                targetContent.setAttribute('aria-hidden', 'false');
            }
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                const isActive = button.id === tabName + '-tab';
                button.classList.toggle('active', isActive);
                button.classList.toggle('border-blue-500', isActive);
                button.classList.toggle('text-blue-600', isActive);
                button.classList.toggle('border-transparent', !isActive);
                button.classList.toggle('text-gray-500', !isActive);
                button.setAttribute('aria-selected', isActive.toString());
                button.setAttribute('tabindex', isActive ? '0' : '-1');
            });
            
            // Load specific tab content
            if (tabName === 'logs') {
                const logsContainer = document.getElementById('logs-container');
                if (logsContainer && typeof htmx !== 'undefined') {
                    htmx.trigger(logsContainer, 'load');
                }
            } else if (tabName === 'enhanced') {
                const urlParams = new URLSearchParams(window.location.search);
                const siteId = urlParams.get('site');
                if (siteId) {
                    loadEnhancedView(siteId);
                }
            }
        }
        
        // Touch device detection
        if ('ontouchstart' in window) {
            document.body.classList.add('touch-device');
        }
        
        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(event) {
            handleUrlParams();
        });
        
        // Initialize HTMX and handle URL params
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 SiteWatch Dashboard loaded');
            handleUrlParams();
            
            // Handle HTMX events for modal details
            document.body.addEventListener('htmx:afterRequest', function(event) {
                if (event.detail.xhr.status === 200 && 
                    event.detail.requestConfig.path.includes('/ui/details/')) {
                    showModal(event.detail.xhr.response);
                }
            });
            
            // Handle ESC key for modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
            
            // Handle modal background click
            document.addEventListener('click', function(e) {
                if (e.target.matches('#modal-container > div')) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>